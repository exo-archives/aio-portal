<?xml version="1.0" encoding="UTF-8" ?>
<!--
 **
 * Created by The eXo Platform SARL
 * Author : dang.tung
 *          tungcnw@gmail.com
 * Oct 01, 2008
 *
-->
<Module>
	<ModulePrefs author="eXoPlatform"
		title="Todo"
		directory_title="Todo"
		title_url="http://www.exoplatform.org"
		description="ToDo Gadget, easily manage and track your daily to-do list."
		thumbnail="http://localhost:8080/eXoGadgets/skin/DefaultSkin/portletIcons/Todo.png"
		height="235">
		<Locale messages="http://localhost:8080/eXoGadgets/locale/Todo/ALL_ALL.xml" />
		<Locale lang="ar" messages="http://localhost:8080/eXoGadgets/locale/Todo/ar_ALL.xml" language_direction="rtl"/>
		<Locale lang="fr" messages="http://localhost:8080/eXoGadgets/locale/Todo/fr_ALL.xml" />
		<Locale lang="vi" messages="http://localhost:8080/eXoGadgets/locale/Todo/vi_ALL.xml" />
		<Require feature="setprefs"/>
	</ModulePrefs>
	<UserPref name="todoList" datatype="list"/>
	<Content type="html">
	<![CDATA[
		<style type="text/css">

			body {
				margin: 0;
				outline: none;
				font: normal 100%/1.25  Verdana, Tahoma, Arial, Helvetica, sans-serif;
				text-decoration: none;
				text-align: center;
			}

			img {
				border:none;
			}

			li {
				list-style-type:none;
			}

			.clear {
				clear:both;
				width:0;
				height:0;
				line-height:0;
				font-size:0;
			}

			.Note {
				background: url(/eXoGadgets/skin/image/Note__BIDI_START_EDGE__.jpg) top __BIDI_START_EDGE__ no-repeat;
				width: 160px;
				height: 235px;
				margin: 0 auto;
				padding: 42px 18px 0 18px;
			}

			.write {
				width: 160px;
				height: 150px;
				overflow-y: auto;
        overflow-x: hidden;
			}

			.write input {
				background: url(/eXoGadgets/skin/image/line.gif) bottom left repeat-x;
				font-size: 11px;
				color: #be0d08;
				border: none;
				width: 100%;
				line-height: auto;
				font-style: italic;
				margin-bottom: 2px;
				height: 15px;
			}
			
			.UIAction .ActionContainer {
				width: auto;
				margin: auto;
			}	
			
			.UIAction .ActionButton {
				display: block;
				float: __BIDI_START_EDGE__; 
				margin: 0px 3px;
				cursor: pointer;
			}
			
			.UIAction .SimpleStyle {}
			
			.UIAction .SimpleStyle .ButtonLeft {
			  background: url('/eXoResources/skin/DefaultSkin/webui/component/UIBarDecorator/UIAction/background/SimpleStyle.gif') no-repeat left top;
			  padding: 0px 0px 0px 10px;
			  height: 21px;
			}
			
			.UIAction .SimpleStyle .ButtonRight {
			  background: url('/eXoResources/skin/DefaultSkin/webui/component/UIBarDecorator/UIAction/background/SimpleStyle.gif') no-repeat right top;
			  padding: 0px 10px 0px 0px ;
			  height: 21px;
			}
			
			.UIAction .SimpleStyle .ButtonMiddle {
			  line-height: 21px;
				background: url('/eXoResources/skin/DefaultSkin/webui/component/UIBarDecorator/UIAction/background/SimpleStyle.gif') repeat-x bottom;
				text-align: center;	
				padding: 0px 12px;
			  height: 21px;
			}
			
			.UIAction .SimpleStyle a {
			  color: #353535;
			  margin: 0px 6px;
			  white-space: nowrap;
			  font-size: 11px;
			  text-decoration: none;
			  display: block;
			}
			
			.UIAction .SimpleStyle a:hover {
			  color: #1273df;
			}

		</style>
		<script type="text/javascript">
				var prefs = new _IG_Prefs(__MODULE_ID__);
				var keynum;
				//var parentGadgets = window.top.gadgets;
				//var gadget = parentGadgets.container.getGadget(prefs.getModuleId());

				function onLoad() {
				var listsTodo = prefs.getArray("todoList");
				var appendParrent = document.getElementById("write");

					for(var i=0; i<listsTodo.length; i++) {
						if(i>6) {
							var input = document.createElement("input");
							input.setAttribute("type","text");
							input.setAttribute("name",i+1);
							input.setAttribute("onkeydown","finish(this,event);");
							input.setAttribute("id",i+1);
							appendParrent.insertBefore(input,null);
						}
						var tmp = document.getElementById(parseInt(i)+1);
						tmp.value = listsTodo[i];
					}
				}


				function save() {
					values = [];
					for (var i = 1; i < 8; i++) {
						values.push(document.getElementById(i).value || "");
					}

					prefs.setArray("todoList", values);
				}

				function finish(element,e) {
					//var lists = window.top.JSON.stringify(gadget.getUserPrefs());
					/* if(lists.length == 0 || lists == "{}") lists = null;
					else {
						lists = lists.substring(1,lists.length-1);
						var listTodo = lists.split("|");
					}*/
					var appendParrent = document.getElementById("write");
					var nameElement = parseInt(element.name) + 1;
					if(window.event) {
						keynum = e.keyCode;
					}else if(e.which) {
						keynum = e.which;
					}
					if(keynum == 13) {
						if(nameElement == 8 && element.nextSibling.nextSibling!=null) {
							element.nextSibling.nextSibling.focus();
							return;
						}
						if(nameElement > 8 && element.nextSibling!=null) {
							element.nextSibling.focus();
							return;
						}
						if(nameElement > 7) {
							var input = document.createElement("input");
							input.setAttribute("type","text");
							input.setAttribute("name",nameElement);
							input.setAttribute("onkeydown","finish(this,event);");
							input.setAttribute("id",nameElement);
							appendParrent.insertBefore(input,null);
						}
						var nextInput = element.nextSibling.nextSibling;
						if(nameElement > 8) nextInput = element.nextSibling;
						if(nextInput.value == null || nextInput.value==""){
							nextInput.value = nameElement + ".";
							if(lists == null) lists = element.value;
							else {
								lists = lists + "|" + element.value;
							}
						} else
						{
							var oldStr = listTodo[parseInt(nameElement-2)];
							var lists = lists.replace(oldStr,element.value);
						}
						//prefs.setArray("todoList",[lists]);

						//gadget.setUserPrefs(lists);
						nextInput.focus();
					}
				}
			    gadgets.util.registerOnLoadHandler(onLoad);
		</script>
			<div class="Note">
	    	<div class="write" id="write">
	        <input type="text" id="1" onfocus="javascript: if(this.value == '1. __MSG_type_here__') this.value='1.'" value="1. __MSG_type_here__" name="1" onkeydown="finish(this,event);"/>
	        <input type="text" id="2" name="2" onkeydown="finish(this,event);"/>
	        <input type="text" id="3" name="3" onkeydown="finish(this,event);"/>
					<input type="text" id="4" name="4" onkeydown="finish(this,event);"/>
					<input type="text" id="5" name="5" onkeydown="finish(this,event);"/>
					<input type="text" id="6" name="6" onkeydown="finish(this,event);"/>
					<input type="text" id="7" name="7" onkeydown="finish(this,event);"/>
					
	      </div>

<div class="UIAction"> 
    <table class="ActionContainer">
	    <tbody><tr>
	    	<td>
		      <div class="ActionButton SimpleStyle" onclick="save();">
		        <div class="ButtonLeft">
		          <div class="ButtonRight">
		            <div class="ButtonMiddle">
		            	<a href="javascript:void(0);">__MSG_save__</a>
		            </div>
		          </div>
		        </div>
		      </div>
		    </td>
      </tr>
 	  </tbody></table>
	</div>
		   </div>
	]]>
	</Content>
</Module>