Index: web/portal/src/main/webapp/groovy/webui/form/UIFormUploadInput.gtmpl
===================================================================
--- web/portal/src/main/webapp/groovy/webui/form/UIFormUploadInput.gtmpl	(revision 71394)
+++ web/portal/src/main/webapp/groovy/webui/form/UIFormUploadInput.gtmpl	(working copy)
@@ -1,18 +1,24 @@
-<%  
-  String uploadId = uicomponent.getUploadId() ;
-  boolean isAutoUpload = uicomponent.isAutoUpload();
-  def rcontext = _ctx.getRequestContext() ;
-  rcontext.getJavascriptManager().importJavascript('eXo.webui.UIUpload') ;
-  rcontext.getJavascriptManager().addCustomizedOnLoadScript("eXo.webui.UIUpload.initUploadEntry('"+uploadId+"',"+isAutoUpload+");") ;
+<%
+	String uploadId = uicomponent.getUploadId();
+	boolean isAutoUpload = uicomponent.isAutoUpload();
+	def rcontext = _ctx.getRequestContext();
+	rcontext.getJavascriptManager().importJavascript('eXo.webui.UIUpload');
+	rcontext.getJavascriptManager().addCustomizedOnLoadScript("eXo.webui.UIUpload.initUploadEntry('"+uploadId+"',"+isAutoUpload+");");
 %>
 <div class="UIFormUploadInput" id="$uploadId">
-  <div class="LimitMessage" style="display: none;"><%= _ctx.appRes("UIFormUploadInput.msg.limit"); %></div>
-  <input type="hidden" id="input$uploadId" name="<%=uicomponent.getName();%>" value="false"/>
-  <div id="<%=uploadId;%>UploadIframe" class="UploadIframe">
-    <iframe height="23px" allowTransparency="true" scrolling="no" frameborder="0" framespacing="0" id="<%=uploadId;%>uploadFrame"></iframe>
-  </div>
-  <div id="<%=uploadId;%>ProgressIframe" class="ProgressIframe" style="display: none;"></div>      
-  <div class="ProgressBarFrame" style="display: none;">
+	<div class="LimitMessage" style="display: none;"><%= _ctx.appRes("UIFormUploadInput.msg.limit"); %></div>
+	<input type="hidden" id="input$uploadId" name="<%=uicomponent.getName();%>" value="false"/>
+	<div id="<%=uploadId;%>UploadIframe" class="UploadIframe">
+		<%if(isAutoUpload) {%>
+			<input id="file" name="file" type="file" onchange="eXo.webui.UIUpload.upload(this,<%=uploadId;%>)" onkeypress='return false;'/>
+		<%} else {%>
+			<input id="file" name="file" type="file" onkeypress='return false;'/>
+			<img id="iconUpload" class="UploadButton" style="width : 20px; height: 20px; cursor: pointer; vertical-align: bottom; background: url('/eXoResources/skin/DefaultSkin/webui/component/UIUpload/background/UpArrow16x16.gif') no-repeat left;" onclick="eXo.webui.UIUpload.upload(this, <%=uploadId;%>)" alt='' src='/eXoResources/skin/sharedImages/Blank.gif'/>
+		<%}%>
+		<iframe height="0" width="0" id="<%=uploadId;%>uploadFrame" style="display: none;"></iframe>
+	</div>
+	<div id="<%=uploadId;%>ProgressIframe" class="ProgressIframe" style="display: none;"></div>			
+	<div class="ProgressBarFrame" style="display: none;">
 		<div class="ProgressBar">
 			<div class="ProgressBarLeft">
 				<div class="ProgressBarMiddle">
@@ -28,8 +34,8 @@
 	</div>
 	<div class="SelectFileFrame" style="display: none;">
 		<div class="FileName">
-			<div class="FileNameLabel"></div>
+			<div class="FileNameLabel"><span></span></div>
 		</div>
 		<div class="RemoveFile" title="Remove Uploaded" onclick="eXo.webui.UIUpload.deleteUpload($uploadId);"></div>
 	</div>
-</div>
\ No newline at end of file
+</div>
Index: web/eXoResources/src/main/webapp/javascript/eXo/webui/UIUpload.js
===================================================================
--- web/eXoResources/src/main/webapp/javascript/eXo/webui/UIUpload.js	(revision 71394)
+++ web/eXoResources/src/main/webapp/javascript/eXo/webui/UIUpload.js	(working copy)
@@ -1,252 +1,298 @@
-function UIUpload() {
-  this.listUpload = new Array();
-  this.isAutoUpload = false;
-  //this.listLimitMB = new Array();
-};
-/**
- * Initialize upload
- * @param {String} uploadId identifier upload
- * @param {boolean} isAutoUpload
- */
-UIUpload.prototype.initUploadEntry = function(uploadId, isAutoUpload) {
-	var url = eXo.env.server.context + "/command?" ;
-	url += "type=org.exoplatform.web.command.handler.UploadHandler&action=progress&uploadId="+uploadId ;
-	var responseText = ajaxAsyncGetRequest(url, false);
-	
-	var response;
-   try{
-    eval("response = "+responseText);
-  }catch(err){
-    return;  
-  }
-  UIUpload.isAutoUpload = isAutoUpload;
-	if(response.upload[uploadId] == undefined || response.upload[uploadId].percent == undefined) {
-		//eXo.webui.UIUpload.listLimitMB.push();
-		this.createUploadEntry(uploadId, isAutoUpload);
-	} else if(response.upload[uploadId].percent == 100)  {
-		this.showUploaded(uploadId, decodeURIComponent(response.upload[uploadId].fileName));
-	} 
-};
-
-
-UIUpload.prototype.createUploadEntry = function(uploadId, isAutoUpload) {
-  var iframe = document.getElementById(uploadId+'uploadFrame');
-  var idoc = iframe.contentWindow.document ;
-  var uploadAction = eXo.env.server.context + "/command?" ;
-  uploadAction += "type=org.exoplatform.web.command.handler.UploadHandler";
-  uploadAction += "&uploadId=" + uploadId+"&action=upload" ;
-  idoc.open();
-	idoc.write("<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>");
-  idoc.write("<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='" +eXo.core.I18n.lang+ "' dir='" +eXo.core.I18n.dir+ "'>");
-  idoc.write("<head>");
-  idoc.write("<style type='text/css'>");
-  idoc.write(".UploadButton {width: 20px; height: 20px; cursor: pointer; vertical-align: bottom;");
-  idoc.write(" background: url('/eXoResources/skin/DefaultSkin/webui/component/UIUpload/background/UpArrow16x16.gif') no-repeat left; }");
-  idoc.write("</style>");
-  idoc.write("<script type='text/javascript'>var eXo = parent.eXo</script>");
-  idoc.write("</head>");
-  idoc.write("<body style='margin: 0px; border: 0px;'>");
-  idoc.write("  <form id='"+uploadId+"' class='UIUploadForm' style='margin: 0px; padding: 0px' action='"+uploadAction+"' enctype='multipart/form-data' method='post'>");
-  if(isAutoUpload){
-  	idoc.write("    <input type='file' name='file' id='file' value='' onchange='eXo.webui.UIUpload.upload(this, "+uploadId+")' onkeypress='return false;' />");
-  }else{
-		idoc.write("    <input type='file' name='file' id='file' value='' onkeypress='return false;' />");
-	  idoc.write("    <img class='UploadButton' onclick='eXo.webui.UIUpload.upload(this, "+uploadId+")' alt='' src='/eXoResources/skin/sharedImages/Blank.gif'/>");  	
-  }
-  idoc.write("  </form>");
-  idoc.write("</body>");
-  idoc.write("</html>");
-  idoc.close();
-};
-
-
-UIUpload.prototype.refeshProgress = function(elementId) {
-  var list =  eXo.webui.UIUpload.listUpload;
-  if(list.length < 1) return;
-  var url = eXo.env.server.context + "/command?" ;
-	url += "type=org.exoplatform.web.command.handler.UploadHandler&action=progress" ;
-//  var url =  eXo.env.server.context + "/upload?action=progress";  
-  for(var i = 0; i < list.length; i++){
-    url = url + "&uploadId=" + list[i];
-  }
-
-  var responseText = ajaxAsyncGetRequest(url, false);
-  if(list.length > 0) {
-    setTimeout("eXo.webui.UIUpload.refeshProgress('" + elementId + "');", 1000); 
-  }
-    
-  var response;
-  try {
-    eval("response = "+responseText);
-  }catch(err) {
-    return;  
-  }
-  
-  for(id in response.upload) {
-    var container = parent.document.getElementById(elementId);
-  	if (response.upload[id].status == "failed") {
-  		this.abortUpload(id);
-  		var message = eXo.core.DOMUtil.findFirstChildByClass(container, "div", "LimitMessage").innerHTML ;
-  		alert(message.replace("{0}", response.upload[id].size)) ;
-//  		alert(response.upload[id].message);
-  		continue;
-  	}
-    var element = document.getElementById(id+"ProgressIframe");
-    var percent  =   response.upload[id].percent;
-    var progressBarMiddle = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarMiddle") ;
-    var blueProgressBar = eXo.core.DOMUtil.findFirstChildByClass(progressBarMiddle, "div", "BlueProgressBar") ;
-    var progressBarLabel = eXo.core.DOMUtil.findFirstChildByClass(blueProgressBar, "div", "ProgressBarLabel") ;
-    blueProgressBar.style.width = percent + "%" ;
-    progressBarLabel.innerHTML = percent + "%" ;
-    
-    if(percent == 100) this.showUploaded(id, "");
-  }
-  
-  if(eXo.webui.UIUpload.listUpload.length < 1) return;
-
-  if (element){
-    element.innerHTML = "Uploaded "+ percent + "% " +
-                        "<span onclick='parent.eXo.webui.UIUpload.abortUpload("+id+")'>Abort</span>";
-  }
-};
-
-UIUpload.prototype.showUploaded = function(id, fileName) {
-	eXo.webui.UIUpload.listUpload.remove(id);
-	var container = parent.document.getElementById(id);
-  var element = document.getElementById(id+"ProgressIframe");
-  element.innerHTML =  "<span></span>";
-  
-  var uploadIframe = eXo.core.DOMUtil.findDescendantById(container, id+"UploadIframe");
-  uploadIframe.style.display = "none";
-  var progressIframe = eXo.core.DOMUtil.findDescendantById(container, id+"ProgressIframe");
-  progressIframe.style.display = "none";
-    
-  var selectFileFrame = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "SelectFileFrame") ;
-  selectFileFrame.style.display = "block" ;
-  var fileNameLabel = eXo.core.DOMUtil.findFirstDescendantByClass(selectFileFrame, "div", "FileNameLabel") ;
-  if(fileName != null) fileNameLabel.innerHTML += " " + fileName;
-  var progressBarFrame = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarFrame") ;
-  progressBarFrame.style.display = "none" ;
-  var tmp = element.parentNode;
-  var temp = tmp.parentNode;
-  //TODO: dang.tung - always return true even we reload browser
-  var  input = parent.document.getElementById('input' + id);
-	input.value = "true" ;  
-};
-/**
- * Abort upload process
- * @param {String} id upload identifier
- */
-UIUpload.prototype.abortUpload = function(id) {
-  eXo.webui.UIUpload.listUpload.remove(id);
-  var url = eXo.env.server.context + "/command?" ;
-	url += "type=org.exoplatform.web.command.handler.UploadHandler&uploadId=" +id+"&action=abort" ;
-//  var url = eXo.env.server.context + "/upload?uploadId=" +id+"&action=abort" ;
-  var request =  eXo.core.Browser.createHttpRequest();
-  request.open('GET', url, false);
-  request.setRequestHeader("Cache-Control", "max-age=86400");
-  request.send(null);
-  
-  var container = parent.document.getElementById(id);
-  var uploadIframe =  eXo.core.DOMUtil.findDescendantById(container, id+"UploadIframe");
-  uploadIframe.style.display = "block";
-  eXo.webui.UIUpload.createUploadEntry(id, UIUpload.isAutoUpload);
-  var progressIframe = eXo.core.DOMUtil.findDescendantById(container, id+"ProgressIframe");
-  progressIframe.style.display = "none";
-
-  var tmp = progressIframe.parentNode;
-  var temp = tmp.parentNode;
-//  var child = eXo.core.DOMUtil.getChildrenByTagName(temp,"label");
-//  child[0].style.visibility =  "visible" ;
-  var progressBarFrame = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarFrame") ;
-  progressBarFrame.style.display = "none" ;
-  var selectFileFrame = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "SelectFileFrame") ;
-  selectFileFrame.style.display = "none" ;
-   
-  var  input = parent.document.getElementById('input' + id);
-  input.value = "false";
-};
-/**
- * Delete upload file
- * @param {String} id upload identifier
- */
-UIUpload.prototype.deleteUpload = function(id) {
-	var url = eXo.env.server.context + "/command?";
-	url += "type=org.exoplatform.web.command.handler.UploadHandler&uploadId=" +id+"&action=delete" ;
-//  var url = eXo.env.server.context + "/upload?uploadId=" +id+"&action=delete" ;
-  var request =  eXo.core.Browser.createHttpRequest();
-  request.open('GET', url, false);
-  request.setRequestHeader("Cache-Control", "max-age=86400");
-  request.send(null);
-  var DOMUtil = eXo.core.DOMUtil;
-  var container = parent.document.getElementById(id);
-  var uploadIframe =  DOMUtil.findDescendantById(container, id+"UploadIframe");
-  uploadIframe.style.display = "block";
-  eXo.webui.UIUpload.createUploadEntry(id, UIUpload.isAutoUpload);
-  var progressIframe = DOMUtil.findDescendantById(container, id+"ProgressIframe");
-  progressIframe.style.display = "none";
-
-  var tmp = progressIframe.parentNode;
-  var temp = tmp.parentNode;
-  var progressBarFrame = DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarFrame") ;
-  progressBarFrame.style.display = "none" ;
-  var selectFileFrame = DOMUtil.findFirstDescendantByClass(container, "div", "SelectFileFrame") ;
-  selectFileFrame.style.display = "none" ;
-   
-  var  input = parent.document.getElementById('input' + id);
-  input.value = "false";
-} ;
-
-
-UIUpload.prototype.upload = function(clickEle, id) {
-	var DOMUtil = eXo.core.DOMUtil;  
-  var container = parent.document.getElementById(id);  
-  var uploadFrame = parent.document.getElementById(id+"uploadFrame");
-  var form = uploadFrame.contentWindow.document.getElementById(id);
-
-  var file  = DOMUtil.findDescendantById(form, "file");
-  if(file.value == null || file.value == '') return;  
-  var infoUploaded = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "FileNameLabel") ;
-  var temp = file.value;
-
-  if (temp.indexOf('/') != -1) {
-    temp = temp.substr((temp.lastIndexOf('/') + 1), temp.length - 1) ;
-  }
-  
-  if (temp.indexOf('\\') != -1) {
-    temp = temp.substr((temp.lastIndexOf('\\') + 1), temp.length - 1) ;
-  }
-  
-  infoUploaded.innerHTML = temp ;
-
-  var progressBarFrame = DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarFrame") ;
-  progressBarFrame.style.display = "block" ;  
-  var progressBarMiddle = DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarMiddle") ;
-  var blueProgressBar = DOMUtil.findFirstChildByClass(progressBarMiddle, "div", "BlueProgressBar") ;
-  var progressBarLabel = DOMUtil.findFirstChildByClass(blueProgressBar, "div", "ProgressBarLabel") ;
-  blueProgressBar.style.width = "0%" ;
-  progressBarLabel.innerHTML = "0%" ;
-  
-  var  input = parent.document.getElementById('input' + id);
-  input.value = "true";
-  
-  var uploadIframe = DOMUtil.findDescendantById(container, id+"UploadIframe");
-  uploadIframe.style.display = "none";
-  var progressIframe = DOMUtil.findDescendantById(container, id+"ProgressIframe");
-  progressIframe.style.display = "none";
-
-  var tmp = progressIframe.parentNode;
-  var temp = tmp.parentNode;
-  
-  form.submit() ;
-  
-  var list = eXo.webui.UIUpload.listUpload;
-  if(list.length == 0) {
-    eXo.webui.UIUpload.listUpload.push(form.id);
-    setTimeout("eXo.webui.UIUpload.refeshProgress('" + id + "');", 1000);
-  } else {
-    eXo.webui.UIUpload.listUpload.push(form.id);  
-  }
-} ;
-
-eXo.webui.UIUpload = new UIUpload();
+/**
+ * Copyright (C) 2009 eXo Platform SAS.
+ * 
+ * This is free software; you can redistribute it and/or modify it
+ * under the terms of the GNU Lesser General Public License as
+ * published by the Free Software Foundation; either version 2.1 of
+ * the License, or (at your option) any later version.
+ * 
+ * This software is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
+ * Lesser General Public License for more details.
+ * 
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this software; if not, write to the Free
+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
+ */
+
+function UIUpload() {
+  this.listUpload = new Array();
+  this.isAutoUpload = false;
+};
+
+/**
+ * Initialize upload and create a upload request to server
+ * @param {String} uploadId identifier upload
+ * @param {boolean} isAutoUpload auto upload or none
+ */
+UIUpload.prototype.initUploadEntry = function(uploadId, isAutoUpload) {
+	var url = eXo.env.server.context + "/command?" ;
+	url += "type=org.exoplatform.web.command.handler.UploadHandler&action=progress&uploadId="+uploadId ;
+	var responseText = ajaxAsyncGetRequest(url, false);	
+	
+	var response;
+   try{
+    eval("response = "+responseText);
+  }catch(err){
+    return;  
+  }
+  UIUpload.isAutoUpload = isAutoUpload;
+	if(response.upload[uploadId] == undefined || response.upload[uploadId].percent == undefined) {
+		this.createUploadEntry(uploadId, isAutoUpload);
+	} else if(response.upload[uploadId].percent == 100)  {
+		this.showUploaded(uploadId, decodeURIComponent(response.upload[uploadId].fileName));
+	} 
+};
+
+UIUpload.prototype.createUploadEntry = function(uploadId, isAutoUpload) {
+	var iframe = document.getElementById(uploadId+'uploadFrame');
+  var idoc = iframe.contentWindow.document ;
+	var uploadAction = eXo.env.server.context + "/command?" ;
+	uploadAction += "type=org.exoplatform.web.command.handler.UploadHandler";
+	uploadAction += "&uploadId=" + uploadId+"&action=upload" ;
+
+  var uploadHTML = "";
+  uploadHTML += "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>";
+  uploadHTML += "<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='" +eXo.core.I18n.lang+ "' dir='" +eXo.core.I18n.dir+ "'>";
+  uploadHTML += "<head>";
+  uploadHTML += "<style type='text/css'>";
+  uploadHTML += ".UploadButton {width: 20px; height: 20px; cursor: pointer; vertical-align: bottom;";
+  uploadHTML += " background: url('/eXoResources/skin/DefaultSkin/webui/component/UIUpload/background/UpArrow16x16.gif') no-repeat left; }";
+  uploadHTML += "</style>";
+  uploadHTML += "</head>";
+  uploadHTML += "<body style='margin: 0px; border: 0px;'>";
+  uploadHTML += "  <form id='"+uploadId+"' class='UIUploadForm' style='margin: 0px; padding: 0px' action='"+uploadAction+"' enctype='multipart/form-data' method='post'>";
+  uploadHTML += "  </form>";
+  uploadHTML += "</body>";
+  uploadHTML += "</html>";  
+  
+  if (navigator.userAgent.toLowerCase().indexOf('chrome') > -1) {
+  	//workaround for Chrome
+  	//When submit in iframe with Chrome, the iframe.contentWindow.document seems not be reconstructed correctly
+  	idoc.open();
+  	idoc.close();
+  	idoc.documentElement.innerHTML = uploadHTML;    	
+  } else {
+  	idoc.open();
+  	idoc.write(uploadHTML);
+  	idoc.close();
+  }
+  this.inputFile = document.getElementById('file');
+	this.iconUpload = document.getElementById('iconUpload');
+};
+
+UIUpload.prototype.reloadUploadIframe = function() {
+	var DOMUtil = eXo.core.DOMUtil;
+  var container = parent.document.getElementById(id);
+  var uploadIframe =  DOMUtil.findDescendantById(container, id+"UploadIframe");
+	this.inputFile.value = null;
+	uploadIframe.appendChild(this.inputFile);
+	uploadIframe.appendChild(this.iconUpload);
+  uploadIframe.style.display = "block";
+	var iframe = parent.document.getElementById(id+"uploadFrame");
+	iframe.contentWindow.document.body.appendChild(this.form);
+}
+
+/**
+ * Refresh progress bar to update state of upload progress
+ * @param {String} elementId identifier of upload bar frame
+ */
+UIUpload.prototype.refeshProgress = function(elementId) {
+  var list =  eXo.webui.UIUpload.listUpload;
+  if(list.length < 1) return;
+	var url = eXo.env.server.context + "/command?" ;
+	url += "type=org.exoplatform.web.command.handler.UploadHandler&action=progress" ;
+
+  for(var i = 0; i < list.length; i++){
+    url = url + "&uploadId=" + list[i];
+  }
+
+  var responseText = ajaxAsyncGetRequest(url, false);
+  if(list.length > 0) {
+    setTimeout("eXo.webui.UIUpload.refeshProgress('" + elementId + "');", 1000); 
+  }
+    
+  var response;
+  try {
+    eval("response = "+responseText);
+  }catch(err) {
+    return;  
+  }
+  
+  for(id in response.upload) {
+    var container = parent.document.getElementById(elementId);
+  	if (response.upload[id].status == "failed") {
+  		this.abortUpload(id);
+  		var message = eXo.core.DOMUtil.findFirstChildByClass(container, "div", "LimitMessage").innerHTML ;
+  		alert(message.replace("{0}", response.upload[id].size)) ;
+  		continue;
+  	}
+    var element = document.getElementById(id+"ProgressIframe");
+    var percent  =   response.upload[id].percent;
+    var progressBarMiddle = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarMiddle") ;
+    var blueProgressBar = eXo.core.DOMUtil.findFirstChildByClass(progressBarMiddle, "div", "BlueProgressBar") ;
+    var progressBarLabel = eXo.core.DOMUtil.findFirstChildByClass(blueProgressBar, "div", "ProgressBarLabel") ;
+    blueProgressBar.style.width = percent + "%" ;
+    progressBarLabel.innerHTML = percent + "%" ;
+    
+    if(percent == 100) this.showUploaded(id, "");
+  }
+  
+  if(eXo.webui.UIUpload.listUpload.length < 1) return;
+
+  if (element){
+    element.innerHTML = "Uploaded "+ percent + "% " +
+                        "<span onclick='parent.eXo.webui.UIUpload.abortUpload("+id+")'>Abort</span>";
+  }
+};
+
+/**
+ * Show uploaded state when upload has just finished a file
+ * @param {String} id uploaded identifier
+ * @param {String} fileName uploaded file name
+ */
+UIUpload.prototype.showUploaded = function(id, fileName) {
+	eXo.webui.UIUpload.listUpload.remove(id);
+	var container = parent.document.getElementById(id);
+  var element = document.getElementById(id+"ProgressIframe");
+  element.innerHTML =  "<span></span>";
+  
+  var uploadIframe = eXo.core.DOMUtil.findDescendantById(container, id+"UploadIframe");
+  uploadIframe.style.display = "none";
+  var progressIframe = eXo.core.DOMUtil.findDescendantById(container, id+"ProgressIframe");
+  progressIframe.style.display = "none";
+    
+  var selectFileFrame = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "SelectFileFrame") ;
+  selectFileFrame.style.display = "block" ;
+  var fileNameLabel = eXo.core.DOMUtil.findFirstDescendantByClass(selectFileFrame, "div", "FileNameLabel") ;
+  if(fileName != null) fileNameLabel.innerHTML += " " + fileName;
+  var progressBarFrame = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarFrame") ;
+  progressBarFrame.style.display = "none" ;
+  var tmp = element.parentNode;
+  var temp = tmp.parentNode;
+  //TODO: dang.tung - always return true even we reload browser
+  var  input = parent.document.getElementById('input' + id);
+	input.value = "true" ;  
+};
+
+/**
+ * Abort upload process
+ * @param {String} id upload identifier
+ */
+UIUpload.prototype.abortUpload = function(id) {
+  eXo.webui.UIUpload.listUpload.remove(id);
+	var url = eXo.env.server.context + "/command?" ;
+	url += "type=org.exoplatform.web.command.handler.UploadHandler&uploadId=" +id+"&action=abort" ;
+
+  var request =  eXo.core.Browser.createHttpRequest();
+  request.open('GET', url, false);
+  request.setRequestHeader("Cache-Control", "max-age=86400");
+  request.send(null);
+  
+  var container = parent.document.getElementById(id);
+  this.reloadUploadIframe();
+  var progressIframe = eXo.core.DOMUtil.findDescendantById(container, id+"ProgressIframe");
+  progressIframe.style.display = "none";
+
+  var tmp = progressIframe.parentNode;
+  var temp = tmp.parentNode;
+  var progressBarFrame = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarFrame") ;
+  progressBarFrame.style.display = "none" ;
+  var selectFileFrame = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "SelectFileFrame") ;
+  selectFileFrame.style.display = "none" ;
+   
+  var  input = parent.document.getElementById('input' + id);
+  input.value = "false";
+};
+
+/**
+ * Delete uploaded file
+ * @param {String} id upload identifier
+ */
+UIUpload.prototype.deleteUpload = function(id) {
+	var url = eXo.env.server.context + "/command?";
+	url += "type=org.exoplatform.web.command.handler.UploadHandler&uploadId=" +id+"&action=delete" ;
+
+  var request =  eXo.core.Browser.createHttpRequest();
+  request.open('GET', url, false);
+  request.setRequestHeader("Cache-Control", "max-age=86400");
+  request.send(null);
+
+  var DOMUtil = eXo.core.DOMUtil;
+  var container = parent.document.getElementById(id);
+  this.reloadUploadIframe();
+
+  var progressIframe = DOMUtil.findDescendantById(container, id+"ProgressIframe");
+  progressIframe.style.display = "none";
+
+  var tmp = progressIframe.parentNode;
+  var temp = tmp.parentNode;
+  var progressBarFrame = DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarFrame") ;
+  progressBarFrame.style.display = "none" ;
+  var selectFileFrame = DOMUtil.findFirstDescendantByClass(container, "div", "SelectFileFrame") ;
+  selectFileFrame.style.display = "none" ;
+   
+  var  input = parent.document.getElementById('input' + id);
+  input.value = "false";
+} ;
+
+/**
+ * Start upload file
+ * @param {Object} clickEle
+ * @param {String} id
+ */
+UIUpload.prototype.upload = function(clickEle, id) {
+  if(this.inputFile.value == null || this.inputFile.value == '') return;  
+	var DOMUtil = eXo.core.DOMUtil;  
+  var container = parent.document.getElementById(id);  
+  var uploadFrame = parent.document.getElementById(id+"uploadFrame");
+  var form = uploadFrame.contentWindow.document.getElementById(id);
+  var infoUploaded = eXo.core.DOMUtil.findFirstDescendantByClass(container, "div", "FileNameLabel") ;
+  var temp = this.inputFile.value;
+
+  if (temp.indexOf('/') != -1) {
+    temp = temp.substr((temp.lastIndexOf('/') + 1), temp.length - 1) ;
+  }
+  
+  if (temp.indexOf('\\') != -1) {
+    temp = temp.substr((temp.lastIndexOf('\\') + 1), temp.length - 1) ;
+  }
+  
+  infoUploaded.innerHTML = temp ;
+
+  var progressBarFrame = DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarFrame") ;
+  progressBarFrame.style.display = "block" ;  
+  var progressBarMiddle = DOMUtil.findFirstDescendantByClass(container, "div", "ProgressBarMiddle") ;
+  var blueProgressBar = DOMUtil.findFirstChildByClass(progressBarMiddle, "div", "BlueProgressBar") ;
+  var progressBarLabel = DOMUtil.findFirstChildByClass(blueProgressBar, "div", "ProgressBarLabel") ;
+  blueProgressBar.style.width = "0%" ;
+  progressBarLabel.innerHTML = "0%" ;
+  
+  var  input = parent.document.getElementById('input' + id);
+  input.value = "true";
+  
+  var uploadIframe = DOMUtil.findDescendantById(container, id+"UploadIframe");
+  uploadIframe.style.display = "none";
+  var progressIframe = DOMUtil.findDescendantById(container, id+"ProgressIframe");
+  progressIframe.style.display = "none";
+
+  var tmp = progressIframe.parentNode;
+  var temp = tmp.parentNode;
+ 
+	form.appendChild(this.inputFile);
+  this.iconUpload.parentNode.removeChild(this.iconUpload);
+  form.submit() ;
+  
+  var list = eXo.webui.UIUpload.listUpload;
+  if(list.length == 0) {
+    eXo.webui.UIUpload.listUpload.push(form.id);
+    setTimeout("eXo.webui.UIUpload.refeshProgress('" + id + "');", 1000);
+  } else {
+    eXo.webui.UIUpload.listUpload.push(form.id);  
+  }
+	this.form = form;
+} ;
+
+eXo.webui.UIUpload = new UIUpload();
